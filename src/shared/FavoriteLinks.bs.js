// Generated by BUCKLESCRIPT VERSION 5.0.6, PLEASE EDIT WITH CARE
'use strict';

var Block = require("bs-platform/lib/js/block.js");
var Curry = require("bs-platform/lib/js/curry.js");
var React = require("react");
var Belt_List = require("bs-platform/lib/js/belt_List.js");
var Caml_option = require("bs-platform/lib/js/caml_option.js");
var FavLink$Ext = require("../resources/FavLink.bs.js");
var ReactUpdate = require("reason-react-update/src/ReactUpdate.bs.js");
var Core = require("@chakra-ui/core");
var ReactFocusLock = require("react-focus-lock");
var BsChakra__Box$Ext = require("../vendor/chakra-ui/BsChakra__Box.bs.js");
var BsChakra__Flex$Ext = require("../vendor/chakra-ui/BsChakra__Flex.bs.js");
var BsChakra__Link$Ext = require("../vendor/chakra-ui/BsChakra__Link.bs.js");
var BsChakra__Text$Ext = require("../vendor/chakra-ui/BsChakra__Text.bs.js");
var BsChakra__Image$Ext = require("../vendor/chakra-ui/BsChakra__Image.bs.js");
var BsChakra__Input$Ext = require("../vendor/chakra-ui/BsChakra__Input.bs.js");
var BsChakra__Stack$Ext = require("../vendor/chakra-ui/BsChakra__Stack.bs.js");
var BsChakra__Button$Ext = require("../vendor/chakra-ui/BsChakra__Button.bs.js");
var BsChakra__IconButton$Ext = require("../vendor/chakra-ui/BsChakra__IconButton.bs.js");
var BsChakra__AspectRatioBox$Ext = require("../vendor/chakra-ui/BsChakra__AspectRatioBox.bs.js");

function FavoriteLinks(Props) {
  var match = React.useState((function () {
          return "";
        }));
  var setNewLink = match[1];
  var newLink = match[0];
  var match$1 = React.useState((function () {
          return false;
        }));
  var setPopover = match$1[1];
  var firstFieldRef = React.useRef((function (param) {
          return undefined;
        }));
  var match$2 = ReactUpdate.useReducer(/* record */[/* links : [] */0], (function (action, state) {
          if (typeof action === "number") {
            if (action === 0) {
              return /* SideEffects */Block.__(2, [(function (self) {
                            var links = localStorage.getItem("links");
                            if (links !== null) {
                              var parsedLinks = FavLink$Ext.apiResource_decode(JSON.parse(links));
                              if (parsedLinks.tag) {
                                console.log("Parse error", parsedLinks[0]);
                                Curry._1(self[/* send */0], /* ReceiveStoredLinks */Block.__(0, [/* array */[]]));
                              } else {
                                Curry._1(self[/* send */0], /* ReceiveStoredLinks */Block.__(0, [parsedLinks[0]]));
                              }
                            } else {
                              Curry._1(self[/* send */0], /* ReceiveStoredLinks */Block.__(0, [/* array */[]]));
                            }
                            return undefined;
                          })]);
            } else {
              return /* SideEffects */Block.__(2, [(function (self) {
                            localStorage.setItem("links", JSON.stringify(FavLink$Ext.apiResource_encode(Belt_List.toArray(self[/* state */1][/* links */0]))));
                            return undefined;
                          })]);
            }
          } else {
            switch (action.tag | 0) {
              case 0 : 
                  return /* Update */Block.__(0, [/* record */[/* links */Belt_List.fromArray(action[0])]]);
              case 1 : 
                  return /* UpdateWithSideEffects */Block.__(1, [
                            /* record */[/* links : :: */[
                                action[0],
                                state[/* links */0]
                              ]],
                            (function (param) {
                                Curry._1(param[/* send */0], /* SaveLinksInStorage */1);
                                Curry._1(setPopover, (function (param) {
                                        return false;
                                      }));
                                return undefined;
                              })
                          ]);
              case 2 : 
                  var link = action[0];
                  return /* UpdateWithSideEffects */Block.__(1, [
                            /* record */[/* links */Belt_List.keep(state[/* links */0], (function (l) {
                                      return l !== link;
                                    }))],
                            (function (param) {
                                Curry._1(param[/* send */0], /* SaveLinksInStorage */1);
                                return undefined;
                              })
                          ]);
              
            }
          }
        }));
  var dispatch = match$2[1];
  React.useEffect((function () {
          Curry._1(dispatch, /* FetchStoredLinks */0);
          return undefined;
        }), ([]));
  var links = match$2[0][/* links */0];
  return React.createElement(React.Fragment, undefined, React.createElement(Core.Stack, Curry._3(BsChakra__Stack$Ext.makeProps(undefined, /* All */Block.__(0, [/* center */98248149]), undefined, /* All */Block.__(0, [/* Theme */Block.__(0, [3])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(true, undefined, React.createElement(Core.Stack, Curry._3(BsChakra__Stack$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(undefined, 10, null), undefined, undefined, /* () */0), links ? React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(/* white */-910341463, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* Theme */Block.__(0, [4])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* Theme */Block.__(0, [/* sm */25754])]), undefined, undefined, undefined, undefined, undefined, undefined)(React.createElement(Core.Stack, Curry._3(BsChakra__Stack$Ext.makeProps(/* All */Block.__(0, [/* center */98248149]), /* All */Block.__(0, [/* center */98248149]), undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["600px"]), undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* wrap */-822134326]))(true, undefined, Belt_List.toArray(Belt_List.map(links, (function (link) {
                                                                  return React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* Theme */Block.__(0, [2])]), /* All */Block.__(0, [/* Theme */Block.__(0, [2])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(null), undefined, /* relative */903134412, undefined, undefined, /* () */0), React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["-10px"]), undefined, undefined, /* All */Block.__(0, ["5px"]))(React.createElement(Core.IconButton, Curry._2(BsChakra__IconButton$Ext.makeProps(/* All */Block.__(0, [/* sm */25754]), undefined, undefined, undefined, /* Theme */Block.__(0, [/* delete */-354893781]))(/* ghost */324570959, undefined, undefined, undefined, undefined, undefined, (function (param) {
                                                                                                        return Curry._1(dispatch, /* RemoveLink */Block.__(2, [link]));
                                                                                                      })), undefined, /* () */0))), undefined, /* absolute */-1013592457, undefined, undefined, /* () */0)), React.createElement(Core.Link, Curry.app(BsChakra__Link$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined)(link), [
                                                                                      undefined,
                                                                                      undefined,
                                                                                      undefined,
                                                                                      React.createElement(Core.Stack, Curry._3(BsChakra__Stack$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["130px"]), undefined, undefined)(undefined, 2, null), undefined, undefined, /* () */0), React.createElement(Core.Flex, Curry._3(BsChakra__Flex$Ext.makeProps(/* gray200 */-103736657, undefined, /* All */Block.__(0, [/* Custom */Block.__(1, ["auto"])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["50px"]), /* All */Block.__(0, ["50px"]), undefined, /* All */Block.__(0, [/* center */98248149]), /* All */Block.__(0, [/* center */98248149]), undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* full */-1010505329]), undefined)(React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["16px"]), /* All */Block.__(0, ["16px"]), undefined, undefined, undefined, undefined, undefined, undefined, undefined)(React.createElement(Core.AspectRatioBox, Curry._3(BsChakra__AspectRatioBox$Ext.makeProps(/* All */Block.__(0, ["16px"]))(React.createElement(Core.Image, Curry._8(BsChakra__Image$Ext.makeProps(undefined, undefined, undefined)(FavLink$Ext.faviconUrl(link)), undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* () */0))), 1, undefined, /* () */0))), undefined, undefined, undefined, undefined, /* () */0))), undefined, undefined, /* () */0)), React.createElement(Core.Text, Curry._5(BsChakra__Text$Ext.makeProps(undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* center */98248149]), undefined)(FavLink$Ext.getSiteName(link)), undefined, undefined, true, undefined, /* () */0))),
                                                                                      undefined,
                                                                                      undefined,
                                                                                      undefined,
                                                                                      undefined,
                                                                                      /* () */0
                                                                                    ])));
                                                                })))), undefined, undefined, /* () */0))), undefined, undefined, undefined, undefined, /* () */0)) : null, React.createElement(Core.Popover, {
                                  isOpen: match$1[0],
                                  onOpen: (function (param) {
                                      return Curry._1(setPopover, (function (param) {
                                                    return true;
                                                  }));
                                    }),
                                  onClose: (function (param) {
                                      return Curry._1(setPopover, (function (param) {
                                                    return false;
                                                  }));
                                    }),
                                  children: null
                                }, React.createElement(Core.PopoverTrigger, {
                                      children: React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* Custom */Block.__(1, ["auto"])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, ["200px"]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(React.createElement(Core.Button, Curry.app(BsChakra__Button$Ext.makeProps(/* All */Block.__(0, [/* lg */24187]), undefined, undefined, undefined, undefined, undefined, undefined)("Add link"), [
                                                            undefined,
                                                            undefined,
                                                            "add",
                                                            undefined,
                                                            undefined,
                                                            undefined,
                                                            undefined,
                                                            undefined,
                                                            undefined,
                                                            undefined,
                                                            /* () */0
                                                          ]))), undefined, undefined, undefined, undefined, /* () */0))
                                    }), React.createElement(Core.PopoverContent, {
                                      children: null
                                    }, React.createElement(Core.PopoverArrow, { }), React.createElement(ReactFocusLock.default, {
                                          returnFocus: true,
                                          persistentFocus: false,
                                          children: React.createElement(Core.Box, Curry._5(BsChakra__Box$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, /* All */Block.__(0, [/* Theme */Block.__(0, [5])]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(React.createElement("form", {
                                                            onSubmit: (function (e) {
                                                                e.preventDefault();
                                                                return Curry._1(dispatch, /* AddLink */Block.__(1, [newLink]));
                                                              })
                                                          }, React.createElement(Core.Stack, Curry._3(BsChakra__Stack$Ext.makeProps(/* All */Block.__(0, [/* flexEnd */924268066]), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)(true, 5, null), undefined, undefined, /* () */0), React.createElement(Core.FormControl, {
                                                                    children: React.createElement(Core.Input, Curry._4(BsChakra__Input$Ext.makeProps(undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined)("https://", undefined, "url", Caml_option.some(firstFieldRef), undefined, (function ($$event) {
                                                                                    var value = $$event.target.value;
                                                                                    return Curry._1(setNewLink, (function (param) {
                                                                                                  return value;
                                                                                                }));
                                                                                  }), undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined), undefined, /* url */5843823, undefined, /* () */0))
                                                                  }), React.createElement(Core.Button, Curry.app(BsChakra__Button$Ext.makeProps(undefined, /* blue */-1055309158, undefined, undefined, undefined, undefined, undefined)("Add"), [
                                                                        undefined,
                                                                        /* submit */436623384,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        undefined,
                                                                        /* () */0
                                                                      ]))))), undefined, undefined, undefined, undefined, /* () */0))
                                        }))))), undefined, undefined, /* () */0)));
}

var make = FavoriteLinks;

exports.make = make;
/* react Not a pure module */
